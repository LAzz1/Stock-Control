<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Language" content="pt-br">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:wght@100;300;400;900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <title>Registration Page</title>
</head>

<body>
    <header>
        <div class="back-button">
            <button src="../zimages/back-arrow.png" type="submit"
                onclick="window.location.href='../home/home.html'">Página Inicial</button>
        </div>
        <h1>Stock Control</h1>
    </header>
    <div class="form-box">
        <form id="userRegistration" method="post" action="connect.php" class="registerUser">
            <fieldset>
                <legend><b>Registro de Produtos</b></legend>
                <br>
                <div id="product-information">
                    <div class="product-name">
                        <label class="labelInput" for="prodname">Nome do produto</label>
                        <input type="text" class="inputSpace" id="prodname" name="name" placeholder="Digite aqui"
                            required>
                    </div>
                    <br>
                    <div id="lote-number">
                        <label class="labelInput" for="lotenumber">Número do lote</label>
                        <input type="text" class="inputSpace" id="lotenumber" name="lote" placeholder="Digite aqui"
                            required>
                    </div>
                    <br>
                    <div id="product-function">
                        <label class="labelInput" for="prodfunction">Função do produto</label>
                        <input type="text" class="inputSpace" id="prodfunction" name="function"
                            placeholder="Digite aqui" required>
                    </div>
                    <hr>
                    <br>
                    <div class="reservation" id="prod-reservation">
                        <label>Alocado para algum paciênte? </label>
                        <input class="radioInput" type="radio" id="yes" name="reservation" value="sim" required>
                        <label for="yes">Sim</label>
                        <input class="radioInput" type="radio" id="no" name="reservation" value="não" required checked>
                        <label for="no">Não</label>
                    </div>
                    <br>
                    <div id="lote-expiration">
                        <label for="loteexpiration">Validade do lote</label>
                        <input type="date" class="inputData" id="loteexpiration" name="expiration" required>
                    </div>
                    <script>
                        function preventSubmitError(event) {
                            rawInputDate = document.querySelector('[class="inputData"]').value
                            splittedInputDate = rawInputDate.split('-');

                            var alertMsg = `Tem certeza que deseja cadastrar esse produto?\n\nNome: ${document.querySelector('[id="prodname"]').value}\nLote: ${document.querySelector('[id="lotenumber"]').value}\nFunção: ${document.querySelector('[id="prodfunction"]').value}\nData de validade: ${splittedInputDate[2]}/${splittedInputDate[1]}/${splittedInputDate[0]}`

                            if (!confirm(alertMsg)) {
                                event.preventDefault();
                                return alert('Seu produto não foi cadastrado!');
                            }
                        }
                    </script>
                    <script>
                        function validations(inputDate, inputText) {

                            function dateValidation(inputDate) {
                                var rawInputDate = document.querySelector('[class="inputData"]').value
                                var splittedInputDate = rawInputDate.split('-');

                                var rawTodayDate = new Date().toLocaleDateString();
                                var splittedTodayDate = rawTodayDate.split('/');
                                validation = true

                                for (let i = 0, j = 2; i < 2; i++, j--) {
                                    if (splittedInputDate[i] < splittedTodayDate[j]) {
                                        validation = false
                                        break
                                    } else {
                                        validation = true
                                    }
                                    if (splittedInputDate[1] == splittedTodayDate[1] && splittedInputDate[2] < splittedTodayDate[0]) {
                                        validation = false
                                        break
                                    } else {
                                        validation = true
                                    }
                                }
                                inputDate = validation
                                return inputDate;
                            }

                            function inputWordValidation(inputText) {
                                var splittedProdName = (document.querySelector('[id="prodname"]').value.trim()).split('')
                                var splittedProdFunction = (document.querySelector('[id="prodfunction"]').value.trim()).split('');

                                if (splittedProdName.length < 2 || splittedProdFunction.length < 2) {
                                    inputText = false;
                                    return inputText;
                                }
                                else {
                                    inputText = true;
                                    return inputText
                                }
                            }

                            if (inputWordValidation(inputText) == false && dateValidation(inputDate) == false) {
                                event.preventDefault();
                                return alert("O nome e função do produto devem conter no minimo 2 letras!\nA data também não pode estar expirada!");
                            }
                            else if (inputWordValidation(inputText) == true && dateValidation(inputDate) == false) {
                                event.preventDefault();
                                return alert("A data não pode estar expirada!");
                            }
                            else if (inputWordValidation(inputText) == false && dateValidation(inputDate) == true) {
                                event.preventDefault();
                                return alert("O nome e função do produto devem conter no minimo 2 letras!");
                            }
                            else {
                                preventSubmitError(event)
                            }

                        }

                    </script>
                </div>
                <br><br>
            </fieldset>
            <div class="form-buttons">
                <button type="submit" onclick="validations(event)">Enviar</button>
                <button type="reset">Limpar</button>
            </div>
        </form>
    </div>
    <div class="scripts-page">
    </div>
</body>

</html>